package views;

import java.io.Serializable;

import javax.annotation.PostConstruct;
import javax.faces.application.FacesMessage;
import javax.faces.bean.ManagedBean;
import javax.faces.bean.SessionScoped;
import javax.faces.context.FacesContext;

import dataAccessLayer.GameDataAccess;
import dataAccessLayer.PlayerDataAccess;
import model.Game;
import model.Player;

@ManagedBean(name = "loginView")
@SessionScoped
public class LoginView implements Serializable {
    /**
     * 
     */
    private static final long serialVersionUID = 1L;
    private String username;
    private String password;

    private Player currentPlayer;
    
    @PostConstruct
    public void init() {
    	//GameDataAccess gda=new GameDataAccess();
    	//GameDataAccess gamesData;
    	gamesData=new GameDataAccess();
    	games=gamesData.listGames();
    	selectedGame=new Game();
    }
    
    public Player getCurrentPlayer() {
		return currentPlayer;
	}

	public void setCurrentPlayer(Player currentPlayer) {
		this.currentPlayer = currentPlayer;
	}

	public String getUsername() {
	return this.username;

    }

    public void setUsername(String value) {
	this.username = value;
    }

    public String getPassword() {
	return password;
    }

    public void setPassword(String value) {
	this.password = value;
    }

    public String login() {
    	
	PlayerDataAccess pda = new PlayerDataAccess();
	if ((this.username != null) && (this.password != null)) {
		currentPlayer=new Player();
		currentPlayer = pda.loginUser(this.username, this.password);
	    if (currentPlayer!=null) {
	    	if(currentPlayer.getType()==null)
	    	{
	    		FacesContext.getCurrentInstance().addMessage(null, new FacesMessage(FacesMessage.SEVERITY_WARN, "Warning!", "This username does not have rights!"));
	    		return "/index";
	    	}
	    	else
	    	{
	    		if(currentPlayer.getType()==1)
	    		{
	    			return "/resources/user";
	    		}
	    		else
	    		{
	    			return "/resources/adminuser";
	    		}
	    	}
	    }
	}
	FacesContext.getCurrentInstance().addMessage(null, new FacesMessage(FacesMessage.SEVERITY_WARN, "Warning!", "Incorrect username or password!"));
	return "/index";
    }
}
