package views;

import java.io.Serializable;
import java.util.HashSet;
import javax.annotation.PostConstruct;
import javax.el.ELContext;
import javax.faces.bean.ManagedBean;
import javax.faces.bean.SessionScoped;
import javax.faces.context.FacesContext;
import javax.faces.event.ActionEvent;
import org.primefaces.event.TransferEvent;
import org.primefaces.model.DualListModel;
import dataAccessLayer.TeamDataAccess;
import model.Game;
import model.Player;
import model.Team;

@ManagedBean(name = "teamsView")
@SessionScoped
public class TeamsView implements Serializable {

	/**
	* 
	*/
	private static final long serialVersionUID = 1L;

	public int indexOfMap=0;
	private boolean existTeams;
	private Team firstTeam;
	private Team secondTeam;
	private boolean showNextPrevious;
	private DualListModel<Player> players;

	public Team getFirstTeam() {
		return firstTeam;
	}

	public void setFirstTeam(Team firstTeam) {
		this.firstTeam = firstTeam;
	}

	public Team getSecondTeam() {
		return secondTeam;
	}

	public void setSecondTeam(Team secondTeam) {
		this.secondTeam = secondTeam;
	}

	public boolean isShowNextPrevious() {
		return showNextPrevious;
	}

	public void setShowNextPrevious(boolean showNextPrevious) {
		this.showNextPrevious = showNextPrevious;
	}

	public boolean isExistTeams() {
		return this.existTeams;
	}

	public void setExistTeams(boolean existTeams) {
		this.existTeams = existTeams;
	}
	
	@PostConstruct
	public void init() {
		if(players==null)
		{
			players=new DualListModel<Player>();
		}	
		this.firstTeam=new Team("Team name");
		this.secondTeam=new Team("Team name");
	}

	public DualListModel<Player> getPlayers() {
		return players;
	}

	public void setPlayers(DualListModel<Player> themes) {
		this.players = themes;
	}

	public void onTransfer(TransferEvent event) {
		
		 System.out.println("Source:");
		 this.firstTeam.setPlayers( new HashSet<Player>(this.players.getSource()));
		
		 for(Player p: this.players.getSource())
		 {
		 System.out.println(p.getUsername());
		 }

		System.out.println("Target:");
		this.secondTeam.setPlayers( new HashSet<Player>(this.players.getTarget()));

		 for(Player p: this.players.getTarget())
		 {
		 System.out.println(p.getUsername());
		 }
	}

	 public void addMessage(ActionEvent actionEvent) {
	       System.out.println("Welcome to Primefaces!!");
	    }
	 
	 public void saveTeams() {
		   
		System.out.println("Hello from save teams!");
		ELContext elContext = FacesContext.getCurrentInstance().getELContext();
     	NextGamesView firstBean = (NextGamesView) elContext.getELResolver().getValue(elContext, null, "nextGamesView");
     	
     	Game game=firstBean.getSelectedGame();
     	System.out.println("save teams for game: "+game.getId());
     	TeamDataAccess.removeTeam(game.getTeam1().getId());
		TeamDataAccess.removeTeam(game.getTeam2().getId());
		for(Player play: this.players.getSource())
		{
			System.out.println(play.getUsername());
			game.setTeam1(TeamDataAccess.AddNewPlayer(game.getTeam1().getId(),play.getId()));
		}
		for(Player play: this.players.getTarget())
		{
			System.out.println(play.getUsername());
			game.setTeam2(TeamDataAccess.AddNewPlayer(game.getTeam2().getId(),play.getId()));
		}
//     	if(game.getTeam1()!=null && game.getTeam2()!=null)
//     	{
//     		System.out.println("Game already has teams!Update teams!");
//     		game.setTeam1(this.firstTeam);
//     		game.setTeam2(this.secondTeam);
//         	firstBean.setSelectedGame(GameDataAccess.UpdateTeams(game));
//     	}
//     	else
//     	{
//     		System.out.println("Game has no teams yet! Add teams first!");
//     		firstTeam=TeamDataAccess.CreateNewTeam(firstTeam);
//     		System.out.println("FirstTeam: "+firstTeam.getName());
//     		for(Player p:firstTeam.getPlayers())
//     		{
//     			System.out.println(p.toString());
//     		}
//     		secondTeam=TeamDataAccess.CreateNewTeam(secondTeam);
//     		
//     		System.out.println("SecondTeam: "+secondTeam.getName());
//     		for(Player p:secondTeam.getPlayers())
//     		{
//     			System.out.println(p.toString());
//     		}
//     		
//     		firstBean.setSelectedGame(GameDataAccess.AddTeams(game.getId(), firstTeam.getId(), secondTeam.getId()));	
//     		}
	 }
}